<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ‰‹æ–æ—¥æ›†">
    <title>æ‰‹æ–æˆç™®æ‚£è€… ğŸ¥¤ 2026 äº’å‹•æ—¥æ›†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        :root {
            --morandi-bg: #f4f1ea;
            --morandi-primary: #9a8c98;
            --morandi-secondary: #c9ada7;
            --morandi-accent: #4a4e69;
            --morandi-text: #22223b;
            --morandi-card: #ffffff;
            --morandi-icon: #bdaea4;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--morandi-bg);
            color: var(--morandi-text);
            margin: 0;
            padding: env(safe-area-inset-top) 20px 20px 20px;
            -webkit-tap-highlight-color: transparent;
        }

        .card {
            background: var(--morandi-card);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .month-btn {
            flex-shrink: 0;
            padding: 8px 16px;
            border-radius: 10px;
            background: white;
            border: 1px solid var(--morandi-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            white-space: nowrap;
        }

        .month-btn.active {
            background: var(--morandi-primary);
            color: white;
            border-color: var(--morandi-primary);
        }

        /* æ—¥æ›†ç¶²æ ¼æ¨£å¼ - å›ºå®šé«˜åº¦ä¸”é˜²æ­¢æº¢å‡º */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .weekday-label {
            text-align: center;
            font-weight: bold;
            color: var(--morandi-primary);
            padding: 5px 0;
            font-size: 12px;
        }

        .day-cell {
            background: white;
            border-radius: 12px;
            height: 75px; 
            padding: 4px;
            border: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .day-cell:active {
            transform: scale(0.95);
            background: #fafafa;
        }

        .day-num {
            font-weight: bold;
            font-size: 11px;
            color: var(--morandi-accent);
            opacity: 0.6;
        }

        /* åœ–æ¨™å®¹å™¨ï¼šå¢åŠ å…§è·ä¸¦å…è¨±æ›è¡Œ */
        .drink-icons-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 1px;
            padding: 2px;
            width: 100%;
        }

        .morandi-cup {
            filter: sepia(0.3) saturate(0.5) hue-rotate(10deg);
            opacity: 0.8;
            line-height: 1;
            display: inline-block;
        }
        
        /* æ ¹æ“šæ¯æ•¸å‹•æ…‹ç¸®å°åœ–æ¨™ */
        .cup-size-1 { font-size: 24px; }
        .cup-size-2 { font-size: 20px; }
        .cup-size-3 { font-size: 16px; }

        /* Modal Styles */
        #modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: flex-end; /* æ‰‹æ©Ÿç«¯å¾åº•éƒ¨å½ˆå‡º */
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 500px;
            border-radius: 24px 24px 0 0; /* åº•éƒ¨é¢æ¿æ¨£å¼ */
            padding: 25px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        @media (min-width: 640px) {
            #modal-overlay { align-items: center; }
            .modal-content { border-radius: 24px; width: 90%; }
        }

        .input-field {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px 14px;
            width: 100%;
            font-size: 16px; /* é˜²æ­¢ iOS è¼¸å…¥è‡ªå‹•æ”¾å¤§ */
            background: #f9fafb;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--morandi-primary);
            background: white;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .option-btn {
            padding: 12px 0;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 13px;
            text-align: center;
            cursor: pointer;
            background: white;
            transition: all 0.2s ease;
            color: #6b7280;
        }

        .option-btn.active {
            background: var(--morandi-accent);
            color: white;
            border-color: var(--morandi-accent);
            font-weight: 500;
        }

        .drink-section {
            background: #fcfcfc;
            padding: 16px;
            border-radius: 18px;
            margin-bottom: 20px;
            border: 1px solid #f0f0f0;
        }

        .stats-badge {
            background-color: var(--morandi-primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .save-btn {
            background: var(--morandi-accent);
            color: white;
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 17px;
            box-shadow: 0 4px 12px rgba(74, 78, 105, 0.2);
        }

        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-2xl font-bold" style="color: var(--morandi-accent)">æ‰‹æ–æ—¥æ›† ğŸ¥¤</h1>
                <p class="text-gray-400 text-[10px] tracking-widest uppercase">Addict Calendar 2026</p>
            </div>
            <div class="text-right">
                <div id="year-total-cups" class="text-2xl font-black leading-none" style="color: var(--morandi-accent)">0</div>
                <div class="text-[9px] text-gray-400 font-bold">ANNUAL CUPS</div>
            </div>
        </header>

        <!-- å¹´åº¦ç¸½è¦½å¡ç‰‡ -->
        <div class="card flex justify-between items-center py-5">
            <div class="flex-1 border-r border-gray-100">
                <div class="text-[10px] text-gray-400 mb-1 font-bold">å¹´åº¦ç¸½èŠ±è²»</div>
                <div id="year-total-cost" class="text-xl font-bold text-gray-700">$0</div>
            </div>
            <div class="flex-1 pl-6">
                <div class="text-[10px] text-gray-400 mb-1 font-bold">æœ¬æœˆç´€éŒ„</div>
                <div class="flex items-baseline gap-1">
                    <span id="month-total-cups" class="text-xl font-bold text-gray-700">0</span>
                    <span class="text-xs text-gray-400">æ¯</span>
                </div>
            </div>
        </div>

        <!-- æœˆä»½æ»‘å‹•å°è¦½ -->
        <div class="flex overflow-x-auto gap-2 mb-6 pb-2 no-scrollbar" id="month-nav" style="-webkit-overflow-scrolling: touch;"></div>

        <!-- ç•¶æœˆæ¨™é¡Œèˆ‡çµ±è¨ˆ -->
        <div class="flex justify-between items-end mb-4">
            <h2 id="current-month-title" class="text-lg font-bold">2026å¹´ 1æœˆ</h2>
            <div class="stats-badge">æœˆèŠ±è²» $<span id="month-total-cost">0</span></div>
        </div>

        <!-- æ—¥æ›†ç¶²æ ¼ -->
        <div class="calendar-grid mb-10" id="calendar-container"></div>
    </div>

    <!-- å½ˆå‡ºå¼è¡¨å–® -->
    <div id="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div> <!-- æŠ½å±œæŠŠæ‰‹æ„Ÿ -->
            
            <div class="flex justify-between items-center mb-6">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800">ç·¨è¼¯è³‡æ–™</h3>
                <button onclick="closeModal(null)" class="text-gray-400 p-2">&times;</button>
            </div>
            
            <div id="drink-forms-container"></div>

            <div class="mt-4 pb-4">
                <button onclick="closeModal(null)" class="save-btn active:opacity-80 transition-opacity">
                    å„²å­˜ä¸¦é—œé–‰
                </button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'DRINK_ADDICT_V3_2026';
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
        const weekdays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
        
        const sugarOptions = ["ç„¡æ³•èª¿æ•´", "å…¨ç³–", "åŠç³–", "å¾®ç³–", "ä¸€åˆ†ç³–", "ç„¡ç³–"];
        const iceOptions = ["å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«", "æº«"];
        
        let currentMonth = new Date().getMonth(); 
        let activeDay = null;
        let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        function initData() {
            if (Object.keys(data).length === 0) {
                for (let m = 0; m < 12; m++) data[m] = {};
            }
        }

        function getDaysInMonth(year, month) { return new Date(year, month + 1, 0).getDate(); }
        function getFirstDayOfMonth(year, month) { return new Date(year, month, 1).getDay(); }

        function renderMonthNav() {
            const nav = document.getElementById('month-nav');
            nav.innerHTML = '';
            months.forEach((name, idx) => {
                const btn = document.createElement('button');
                btn.className = `month-btn ${idx === currentMonth ? 'active' : ''}`;
                btn.textContent = name;
                btn.onclick = () => { 
                    currentMonth = idx; 
                    renderCalendar(); 
                    renderMonthNav();
                    // è‡ªå‹•æ»¾å‹•é¸ä¸­çš„æœˆä»½åˆ°è¦–ç·šä¸­å¿ƒ
                    btn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                };
                nav.appendChild(btn);
            });
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-container');
            container.innerHTML = '';
            document.getElementById('current-month-title').textContent = `2026å¹´ ${currentMonth + 1}æœˆ`;

            weekdays.forEach(day => {
                const d = document.createElement('div');
                d.className = 'weekday-label';
                d.textContent = day;
                container.appendChild(d);
            });

            const daysCount = getDaysInMonth(2026, currentMonth);
            const firstDay = getFirstDayOfMonth(2026, currentMonth);

            for (let i = 0; i < firstDay; i++) {
                container.appendChild(document.createElement('div'));
            }

            for (let d = 1; d <= daysCount; d++) {
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                cell.onclick = () => openModal(d);
                
                const dayData = data[currentMonth][d] || [];
                const validDrinks = dayData.filter(dr => dr.shop || dr.item);
                const count = validDrinks.length;

                let sizeClass = 'cup-size-1';
                if (count === 2) sizeClass = 'cup-size-2';
                else if (count >= 3) sizeClass = 'cup-size-3';

                let drinkIcons = '';
                for(let k = 0; k < count; k++) {
                    drinkIcons += `<span class="morandi-cup ${sizeClass}">ğŸ¥¤</span>`;
                }
                
                cell.innerHTML = `
                    <div class="day-num">${d}</div>
                    <div class="drink-icons-container">
                        ${drinkIcons}
                    </div>
                `;
                container.appendChild(cell);
            }
            calculateStats();
        }

        function openModal(day) {
            activeDay = day;
            document.getElementById('modal-title').textContent = `${currentMonth + 1}æœˆ ${day}æ—¥ é£²å“ç´€éŒ„`;
            document.getElementById('modal-overlay').style.display = 'flex';
            document.body.style.overflow = 'hidden'; // ç¦æ­¢åº•å±¤æ»¾å‹•
            
            const container = document.getElementById('drink-forms-container');
            container.innerHTML = '';
            
            if (!data[currentMonth][day]) data[currentMonth][day] = [{}, {}, {}];
            const dayData = data[currentMonth][day];

            for (let i = 0; i < 3; i++) {
                const drink = dayData[i] || {};
                const section = document.createElement('div');
                section.className = 'drink-section';
                section.innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        <span class="w-5 h-5 bg-slate-200 rounded-full flex items-center justify-center text-[10px] font-bold text-white">${i+1}</span>
                        <h4 class="font-bold text-gray-500 text-xs">ç¬¬ ${i+1} æ¯</h4>
                    </div>
                    
                    <div class="space-y-3 mb-5">
                        <input type="text" class="input-field" placeholder="é£²æ–™åº—åç¨±" value="${drink.shop || ''}" oninput="updateTempData(${i}, 'shop', this.value)">
                        <input type="text" class="input-field" placeholder="é£²å“å“é …" value="${drink.item || ''}" oninput="updateTempData(${i}, 'item', this.value)">
                        <input type="number" class="input-field" placeholder="åƒ¹æ ¼" value="${drink.price || ''}" oninput="updateTempData(${i}, 'price', this.value)">
                    </div>

                    <div class="mb-5">
                        <span class="text-[10px] font-bold text-gray-400 block mb-2 px-1">ç”œåº¦æº«åº¦é¸æ“‡</span>
                        <div class="option-grid">
                            ${sugarOptions.map(opt => `<div class="option-btn ${drink.sugar === opt ? 'active' : ''}" onclick="updateOption(${i}, 'sugar', '${opt}', this)">${opt}</div>`).join('')}
                        </div>
                    </div>

                    <div>
                        <div class="option-grid">
                            ${iceOptions.map(opt => `<div class="option-btn ${drink.ice === opt ? 'active' : ''}" onclick="updateOption(${i}, 'ice', '${opt}', this)">${opt}</div>`).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(section);
            }
        }

        function updateTempData(idx, field, val) {
            data[currentMonth][activeDay][idx][field] = val;
            saveData();
        }

        function updateOption(idx, field, val, el) {
            const btns = el.parentElement.parentElement.querySelectorAll('.option-btn');
            btns.forEach(b => {
                // å¦‚æœæ˜¯åŒä¸€å€‹ grid ä¸‹çš„æŒ‰éˆ•æ‰æ¸…é™¤
                if(b.parentElement === el.parentElement) b.classList.remove('active');
            });
            
            if (data[currentMonth][activeDay][idx][field] === val) {
                data[currentMonth][activeDay][idx][field] = null;
                el.classList.remove('active');
            } else {
                data[currentMonth][activeDay][idx][field] = val;
                el.classList.add('active');
            }
            saveData();
        }

        function closeModal(e) {
            if (e && e.target !== document.getElementById('modal-overlay')) return;
            document.getElementById('modal-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            renderCalendar();
        }

        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

        function calculateStats() {
            let yc = 0, ycost = 0, mc = 0, mcost = 0;
            for (let m = 0; m < 12; m++) {
                for (let d in data[m]) {
                    data[m][d].forEach(dr => {
                        if (dr.shop || dr.item) {
                            yc++; ycost += (parseInt(dr.price) || 0);
                            if (parseInt(m) === currentMonth) { mc++; mcost += (parseInt(dr.price) || 0); }
                        }
                    });
                }
            }
            document.getElementById('month-total-cups').textContent = mc;
            document.getElementById('month-total-cost').textContent = mcost;
            document.getElementById('year-total-cups').textContent = yc;
            document.getElementById('year-total-cost').textContent = `$${ycost.toLocaleString()}`;
        }

        window.onload = () => {
            initData();
            renderMonthNav();
            renderCalendar();
            // åˆå§‹åŒ–æ™‚æ»¾å‹•åˆ°ç•¶æœˆ
            const activeBtn = document.querySelector('.month-btn.active');
            if(activeBtn) activeBtn.scrollIntoView({ inline: 'center' });
        };
    </script>
</body>
</html>

